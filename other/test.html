<script>
    function initializeEnquiryFeature() {

        // --- FUNCTION TO GET ALL PRODUCT DATA FROM THE CART ---
        const sendToBackend = () => {
            try {
                // Get the main store object
                const store = window.wp.data.select('wc/store/cart');

                // Let's inspect this object in the console to see what's available
                // console.log('Inspecting the WooCommerce store object:', store);

                // The correct method is likely getCartData(), which contains an 'items' array.
                const cartData = store.getCartData();
                const cartItems = cartData.items;

                if (!cartItems || cartItems.length === 0) {
                    console.log('No items found in the cart.');
                    return;
                }

                // Extract just the product IDs and quantities into a simpler array
                const productData = cartItems.map(item => {
                    return {
                        id: item.id,
                        name: item.name,
                        quantity: item.quantity
                    };
                });

                // Print the final, extracted data to the browser's console
                //console.log('--- Cart Product Data ---');
                console.log(productData);

                // This is where you would send the 'productData' to your backend

            } catch (error) {
                console.error('An error occurred while fetching cart data:', error);
                alert('Could not retrieve cart items. Please try again.');
            }
        };


        // --- PART 1: ADD THE BUTTON TO THE PAGE ---

        const addEnquiryButton = () => {
            const checkoutButtonContainer = document.querySelector('.wc-block-cart__submit-container');
            const enquiryButtonExists = document.getElementById('send-enquiry-btn');

            if (checkoutButtonContainer && !enquiryButtonExists) {
                const originalButton = checkoutButtonContainer.querySelector('a');
                if (!originalButton) return;

                const enquiryButton = originalButton.cloneNode(true);
                enquiryButton.id = 'send-enquiry-btn';
                enquiryButton.querySelector('.wc-block-components-button__text').textContent = 'Send Enquiry';
                enquiryButton.href = '#';

                const newButtonContainer = document.createElement('div');
                newButtonContainer.className = 'wc-block-cart__submit-container';
                newButtonContainer.style.marginTop = '10px';
                newButtonContainer.appendChild(enquiryButton);

                checkoutButtonContainer.parentNode.insertBefore(newButtonContainer, checkoutButtonContainer.nextSibling);

                setupPopupLogic();
            }
        };


        // --- PART 2: HANDLE THE POPUP LOGIC ---

        const setupPopupLogic = () => {
            const enquiryBtn = document.getElementById('send-enquiry-btn');
            const popupOverlay = document.getElementById('enquiry-popup-overlay');
            const closePopupBtn = document.getElementById('close-popup-btn');
            const enquiryForm = document.getElementById('enquiry-form');

            if (enquiryBtn) {
                enquiryBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    popupOverlay.style.display = 'flex';
                });
            }

            function closePopup() {
                popupOverlay.style.display = 'none';
            }

            if (closePopupBtn) {
                closePopupBtn.addEventListener('click', closePopup);
            }

            if (popupOverlay) {
                popupOverlay.addEventListener('click', function (e) {
                    if (e.target === popupOverlay) {
                        closePopup();
                    }
                });
            }

            if (enquiryForm) {
                enquiryForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    sendToBackend();

                    alert('Thank you! Your enquiry has been sent. Check the console to see the product data.');

                    closePopup();
                    enquiryForm.reset();
                });
            }
        };

        const cartCheck = setInterval(function () {
            if (document.querySelector('.wc-block-cart__submit-container')) {
                clearInterval(cartCheck);
                addEnquiryButton();
            }
        }, 500);
    }


    const readyCheck = setInterval(function () {
        if (window.wp && window.wp.data && window.wp.data.select('wc/store/cart')) {
            clearInterval(readyCheck);
            initializeEnquiryFeature();
        }
    }, 100); 
</script>





<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    // Show SweetAlert2 loader
    Swal.fire({
        title: 'Submitting...',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });




    // Close loader
    Swal.close();





    Swal.close();
    console.error("Error submitting enquiry:", error);
    Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Failed to submit enquiry. Please try again.'
    });

</script>

<script>
    /**
 * Fetches a product by its ID and returns its default variation.
 * For variable products, the "default" is assumed to be the first one in the variations array.
 *
 * @param {number} productId The ID of the parent (variable) product.
 * @returns {object|null} The default variation object, or null if not found or not a variable product.
 */
    async function getDefaultVariation(productId) {
        // Use resolveSelect to handle the asynchronous data fetching from the store
        const product = await window.wp.data.resolveSelect('wc/store/products').getProduct(productId);

        // 1. Check if the product was found and is a variable product
        if (!product || product.type !== 'variable') {
            console.log(`Product #${productId} is not a variable product or could not be found.`);
            return null;
        }

        // 2. Check if the product has any variations listed
        if (!product.variations || product.variations.length === 0) {
            console.log(`Product #${productId} has no variations.`);
            return null;
        }

        // 3. Return the first variation in the array as the default
        const defaultVariation = product.variations[0];

        // The defaultVariation object contains its own id, price, attributes, etc.
        // console.log('Default Variation ID:', defaultVariation.id);
        // console.log('Default Variation Price:', defaultVariation.prices.price);

        return defaultVariation;
    }

    
    // --- EXAMPLE USAGE ---
    // Replace 5340 with the ID of a variable product on your store
    const variableProductId = 5340;

    getDefaultVariation(variableProductId).then(variation => {
        if (variation) {
            console.log('Found default variation:', variation);

            // Now you can use this variation's ID to add it to the cart,
            // display its price, etc.
            // Example:
            // const { dispatch } = window.wp.data;
            // dispatch('wc/store/cart').addItemToCart({ id: variation.id, quantity: 1 });
        } else {
            console.log('Could not retrieve a default variation.');
        }
    });
</script>